RG_NAME="rg-4.12"
SQL_SERVER_NAME="asxascac621"
SQL_ADMIN_USER="rezadmin"
SQL_ADMIN_PASSWORD="Pass$2551wordor"

az sql server create --resource-group $RG_NAME --name $SQL_SERVER_NAME --admin-user $SQL_ADMIN_USER --admin-password $SQL_ADMIN_PASSWORD

az sql db create --resource-group $RG_NAME --server $SQL_SERVER_NAME --name db01 --compute-model Serverless --edition GeneralPurpose --family Gen5 --auto-pause-delay 60 --min-capacity 0.5 --capacity 2 --sample-name AdventureWorksLT

az sql server firewall-rule create --resource-group $RG_NAME --server $SQL_SERVER_NAME --name allowAzureServices --start-ip-address 0.0.0.0 --end-ip-address 0.0.0.0


STORAGE_NAME="ascasdafa51415"
CONTAINER_NAME="sqlbackups"

az storage account create --name $STORAGE_NAME --resource-group $RG_NAME --sku Standard_LRS

STORAGE_KEY_1=$(az storage account keys list --resource-group $RG_NAME --account-name $STORAGE_NAME --query [0].value --output tsv)

MSYS_NO_PATHCONV=1 az storage container create --name $CONTAINER_NAME --account-name $STORAGE_NAME --account-key $STORAGE_KEY_1


MSYS_NO_PATHCONV=1 az sql db export --resource-group $RG_NAME --server $SQL_SERVER_NAME --name db01 --admin-user $SQL_ADMIN_USER --admin-password $SQL_ADMIN_PASSWORD --storage-key $STORAGE_KEY_1 --storage-key-type StorageAccessKey --storage-uri $STORAGE_URI 


MSYS_NO_PATHCONV=1 az storage blob list --container-name $CONTAINER_NAME --account-key $STORAGE_KEY_1 --account-name $STORAGE_NAME --query "[].{Name: name, Length: properties.contentLength}"



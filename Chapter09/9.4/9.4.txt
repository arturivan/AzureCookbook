az extension add --name containerapp --upgrade

az provider register --namespace Microsoft.App

az provider register --namespace Microsoft.OperationalInsights

rgName="cookch09-rg"
envName="my-environment"
registryName="cookbookcliacr"

acrLoginServer=$(az acr show --resource-group $rgName --name $registryName --query loginServer -o tsv)
acrAdminUser=$(az acr credential show --resource-group $rgName --name $registryName --query username -o tsv)
acrAdminPass=$(az acr credential show --resource-group $rgName --name $registryName --query passwords[0].value -o tsv)

az containerapp env create --name $envName --resource-group $rgName 

az containerapp create --name cookbook-container-app01 --resource-group $rgName --image $acrLoginServer"/static-html-image:ver1.0" --environment $envName --ingress external --target-port 80 --registry-server $acrLoginServer --registry-username $acrAdminUser --registry-password $acrAdminPass

appHost=$(az containerapp show --name cookbook-container-app01 --resource-group $rgName --query properties.configuration.ingress.fqdn --output tsv)

appURL="http://"$appHost

echo $appURL

az containerapp env delete \
  --name $envName \
  --resource-group $rgName

az containerapp delete \
  --resource-group $rgName \
  --name my-container-app


#https://learn.microsoft.com/en-us/cli/azure/containerapp?view=azure-cli-latest#az-containerapp-create

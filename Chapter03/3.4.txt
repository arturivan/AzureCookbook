RG_NAME="rg-msi"
STORAGE_NAME="sxasxsaxxaxxasxax"

az storage account create --name $STORAGE_NAME --resource-group $RG_NAME --location eastus --sku Standard_LRS 


FUNC_STORAGE_NAME="fnfnfnfnfnfnfnfnfnstr"

az storage account create --name $FUNC_STORAGE_NAME --resource-group $RG_NAME --location eastus --sku Standard_LRS 

APP_SERVICE_PLAN_NAME="plannnnnn01"
FUNCTION_APP_NAME="funcapapapapapa"

az appservice plan create --resource-group $RG_NAME --name $APP_SERVICE_PLAN_NAME --sku S1 --location eastus

az functionapp create --resource-group $RG_NAME --name $FUNCTION_APP_NAME --storage-account $FUNC_STORAGE_NAME --assign-identity [system] --functions-version 3 --plan $APP_SERVICE_PLAN_NAME

STORAGE_RESOURCE_ID=$(az storage account show --name $STORAGE_NAME --resource-group $RG_NAME --query id --output tsv)

FUNC_OBJECT_ID=$(az functionapp show --name $FUNCTION_APP_NAME --resource-group $RG_NAME --query identity.principalId --output tsv)

ROLE_DEF_ID=$(az role definition list --name "Storage Blob Data Contributor" --query [].id  --output tsv)

MSYS_NO_PATHCONV=1 az role assignment create --assignee $FUNC_OBJECT_ID --role $ROLE_DEF_ID --scope $STORAGE_RESOURCE_ID

